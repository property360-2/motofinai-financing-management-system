{% extends "layouts/base.html" %}

{% block title %}{{ user_obj.get_full_name|default:user_obj.username }}{% endblock title %}

{% block content %}
  <section class="mx-auto max-w-4xl px-6 py-12">
    <div class="mb-8 flex items-start justify-between">
      <div>
        <p class="text-sm uppercase tracking-wide text-sky-600">User Management</p>
        <h1 class="mt-1 text-3xl font-semibold text-slate-900">
          {{ user_obj.get_full_name|default:user_obj.username }}
          {% if user_obj.is_superuser %}
            <span class="ml-2 inline-flex items-center rounded-full bg-purple-100 px-3 py-1 text-sm font-medium text-purple-700">Superuser</span>
          {% endif %}
        </h1>
        <p class="mt-2 text-sm text-slate-600">@{{ user_obj.username }}</p>
      </div>
      <div class="flex gap-2">
        <a
          href="{% url 'users:user-list' %}"
          class="inline-flex items-center justify-center rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-50"
        >
          Back to List
        </a>
        {% if can_manage_users %}
          <a
            href="{% url 'users:user-edit' user_obj.pk %}"
            class="inline-flex items-center justify-center rounded-lg bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-sky-700"
          >
            Edit User
          </a>
        {% endif %}
      </div>
    </div>

    <div class="grid gap-6 lg:grid-cols-2">
      <!-- Basic Information -->
      <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <h2 class="mb-4 text-lg font-semibold text-slate-900">Basic Information</h2>
        <dl class="space-y-4">
          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Username</dt>
            <dd class="mt-1 text-sm text-slate-900">{{ user_obj.username }}</dd>
          </div>

          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Email</dt>
            <dd class="mt-1 text-sm text-slate-900">
              {% if user_obj.email %}
                <a href="mailto:{{ user_obj.email }}" class="text-sky-600 hover:text-sky-700">{{ user_obj.email }}</a>
              {% else %}
                <span class="text-slate-400">Not provided</span>
              {% endif %}
            </dd>
          </div>

          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Full Name</dt>
            <dd class="mt-1 text-sm text-slate-900">
              {% if user_obj.first_name or user_obj.last_name %}
                {{ user_obj.first_name }} {{ user_obj.last_name }}
              {% else %}
                <span class="text-slate-400">Not provided</span>
              {% endif %}
            </dd>
          </div>

          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Date Joined</dt>
            <dd class="mt-1 text-sm text-slate-900">{{ user_obj.date_joined|date:"F d, Y \a\t g:i A" }}</dd>
          </div>

          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Last Login</dt>
            <dd class="mt-1 text-sm text-slate-900">
              {% if user_obj.last_login %}
                {{ user_obj.last_login|date:"F d, Y \a\t g:i A" }}
              {% else %}
                <span class="text-slate-400">Never</span>
              {% endif %}
            </dd>
          </div>
        </dl>
      </div>

      <!-- Role & Permissions -->
      <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <h2 class="mb-4 text-lg font-semibold text-slate-900">Role & Permissions</h2>
        <dl class="space-y-4">
          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Role</dt>
            <dd class="mt-1">
              {% if user_obj.role == "admin" %}
                <span class="inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-sm font-medium text-blue-700">Admin</span>
              {% elif user_obj.role == "finance" %}
                <span class="inline-flex items-center rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-700">Finance</span>
              {% else %}
                <span class="inline-flex items-center rounded-full bg-slate-200 px-3 py-1 text-sm font-medium text-slate-700">{{ user_obj.get_role_display }}</span>
              {% endif %}
            </dd>
          </div>

          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Status</dt>
            <dd class="mt-1">
              {% if user_obj.is_active %}
                <span class="inline-flex items-center rounded-full bg-emerald-100 px-3 py-1 text-sm font-medium text-emerald-700">Active</span>
              {% else %}
                <span class="inline-flex items-center rounded-full bg-slate-200 px-3 py-1 text-sm font-medium text-slate-700">Inactive</span>
              {% endif %}
            </dd>
          </div>

          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Staff Status</dt>
            <dd class="mt-1">
              {% if user_obj.is_staff %}
                <span class="inline-flex items-center rounded-full bg-amber-100 px-3 py-1 text-sm font-medium text-amber-700">Staff</span>
              {% else %}
                <span class="inline-flex items-center rounded-full bg-slate-200 px-3 py-1 text-sm font-medium text-slate-700">Not Staff</span>
              {% endif %}
            </dd>
          </div>

          <div>
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Superuser</dt>
            <dd class="mt-1">
              {% if user_obj.is_superuser %}
                <span class="inline-flex items-center rounded-full bg-purple-100 px-3 py-1 text-sm font-medium text-purple-700">Yes</span>
              {% else %}
                <span class="inline-flex items-center rounded-full bg-slate-200 px-3 py-1 text-sm font-medium text-slate-700">No</span>
              {% endif %}
            </dd>
          </div>
        </dl>
      </div>
    </div>

    <!-- Activity Summary -->
    <div class="mt-6 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
      <h2 class="mb-4 text-lg font-semibold text-slate-900">Activity Summary</h2>
      <div class="grid gap-6 sm:grid-cols-3">
        <div>
          <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Loan Applications</dt>
          <dd class="mt-2 text-2xl font-semibold text-slate-900">{{ user_obj.submitted_loan_applications.count }}</dd>
          <dd class="mt-1 text-xs text-slate-500">Submitted applications</dd>
        </div>

        <div>
          <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Payments Recorded</dt>
          <dd class="mt-2 text-2xl font-semibold text-slate-900">{{ user_obj.recorded_payments.count }}</dd>
          <dd class="mt-1 text-xs text-slate-500">Payment transactions</dd>
        </div>

        <div>
          <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Documents Uploaded</dt>
          <dd class="mt-2 text-2xl font-semibold text-slate-900">{{ user_obj.uploaded_loan_documents.count }}</dd>
          <dd class="mt-1 text-xs text-slate-500">Supporting documents</dd>
        </div>
      </div>
    </div>

    <!-- Role Description -->
    <div class="mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-6">
      <h3 class="mb-2 text-sm font-semibold text-slate-900">Role Capabilities</h3>
      {% if user_obj.role == "admin" %}
        <p class="text-sm text-slate-600">
          Admins have full system access including user management, inventory management, loan approvals, payment recording, risk assessment, and repossession case management.
        </p>
      {% elif user_obj.role == "finance" %}
        <p class="text-sm text-slate-600">
          Finance users can manage loan applications, record payments, view risk assessments, and monitor payment schedules. They cannot manage users or modify system settings.
        </p>
      {% endif %}
    </div>
  </section>
{% endblock content %}
